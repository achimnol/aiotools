Use thread-local storage to store per-task states and avoid lock contention in free-threaded builds
